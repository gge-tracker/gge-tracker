<div *ngIf="!isInLoading" class="container-fluid">
  <div class="gge-stats-grid">
    <div class="gge-stat-card" *ngFor="let card of cards; let i = index">
      <button class="gge-stat-ctl h-100" role="button" aria-haspopup="dialog"
        [attr.aria-label]="card.label + (card.value ? ' : ' + card.value : '')"
        [attr.data-bs-toggle]="card.identifier !== 'events_participation_rate' ? 'modal' : false"
        [attr.data-bs-target]="card.identifier !== 'events_participation_rate' ? '#statsModal' : false"
        (click)="openModal(card.identifier, card)" (keyup.enter)="openModal(card.identifier, card)"
        [disabled]="card.identifier === 'events_participation_rate'">
        <div class="gge-stat-inner">
          <div class="gge-stat-top">
            <div class="gge-stat-iconwrap">
              <img [src]="card.logo" alt="" class="gge-stat-icon">
            </div>
            <div class="gge-stat-meta">
              <div class="gge-stat-label" [title]="card.label | translate">{{ card.label | translate }}</div>
              <div class="gge-stat-mini"> {{ serverService.currentServer }} </div>
            </div>
            <div class="gge-stat-cta">
              <span class="gge-stat-chevron" aria-hidden="true">›</span>
            </div>
          </div>
          <div class="gge-stat-mid">
            <div class="gge-stat-value" aria-live="polite">{{ card.value }}</div>
            <div class="gge-stat-change"
              [ngClass]="{ 'gge-up': card.valueCompare > 0, 'gge-down': card.valueCompare < 0 }">
              {{ card.avg === '0' ? '-' : card.avg + ' ' + ('(depuis 1h)' | translate) }}
            </div>
          </div>
          <div class="gge-stat-bottom">
            <span class="gge-stat-badge" *ngIf="card.identifier !== 'events_participation_rate'">{{ 'Voir le détail' |
              translate }}</span>
          </div>
        </div>
        <span class="gge-ripple" aria-hidden="true"></span>
      </button>
    </div>
  </div>





  <div class="modal fade" id="statsModal" tabindex="-1" aria-labelledby="statsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="statsModalLabel" *ngIf="selectedCard"><img class="cardIcon"
              [src]="selectedCard!.logo" [alt]="selectedCard.label | translate"> {{ selectedCard!.label | translate }}
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"
            [attr.aria-label]="'Fermer' | translate"></button>
        </div>
        <div class="modal-body" *ngIf="charts['statistics']">
          <ul class="nav nav-tabs pt-3 ps-3">
            <li class="nav-item">
              <button class="nav-link" (click)="changeTab('graph')" [ngClass]="selectedTab === 'graph' ? 'active' : ''">
                <i class="fas fa-chart-line"></i>
                {{ 'Visualisation' | translate }}</button>
            </li>
            <li class="nav-item">
              <button class="nav-link" (click)="export()">
                <i class="fas fa-download"></i>
                {{ 'Exporter les données' | translate }}
              </button>
            </li>
          </ul>
          <app-charts-wrapper [ngClass]="selectedTab === 'graph' ? 'd-block' : 'd-none'"
            [series]="charts['statistics'].series" *ngIf="isBrowser" [chart]="charts['statistics'].chart"
            [xaxis]="charts['statistics'].xaxis" [yaxis]="charts['statistics'].yaxis"
            [plotOptions]="charts['statistics'].plotOptions" [dataLabels]="charts['statistics'].dataLabels"
            [grid]="charts['statistics'].grid" [colors]="charts['statistics'].colors" [fill]="charts['statistics'].fill"
            [legend]="charts['statistics'].legend" [stroke]="charts['statistics'].stroke"
            [title]="charts['statistics'].title" [tooltip]="charts['statistics'].tooltip"
            [forecastDataPoints]="charts['statistics'].forecastDataPoints!"
            [annotations]="charts['statistics'].annotations!"></app-charts-wrapper>
        </div>
      </div>
    </div>
  </div>
